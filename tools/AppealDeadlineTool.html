<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上訴期間計算小工具</title>
    <!-- 引入 html2canvas 函式庫用以截圖下載 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #d35400;
            --bg-color: #FAF7F2; /* 米白色背景 */
            --card-bg: #ffffff;
            --border-color: #ccc;
            --criminal-color: #27ae60;
            --civil-color: #2980b9;
        }

        body {
            font-family: "Microsoft JhengHei", "PingFang TC", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #222;
            font-size: 22px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
        }

        .page-title {
            text-align: center;
            font-size: 42px;
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 10px;
            margin-bottom: 30px;
        }

        .header-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        /* 控制列 */
        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .type-switch {
            display: flex;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }

        .type-switch input { display: none; }
        .type-switch label {
            padding: 10px 40px;
            cursor: pointer;
            font-size: 22px;
            transition: all 0.3s;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
        }

        .type-switch input:checked + label.lab-crim { background-color: var(--criminal-color); color: white; }
        .type-switch input:checked + label.lab-civ { background-color: var(--civil-color); color: white; }

        .download-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-row {
            display: flex;
            justify-content: space-between;
            gap: 30px;
            flex-wrap: wrap;
        }

        .input-group {
            flex: 1;
            min-width: 400px;
        }

        .input-group label {
            display: block;
            margin-bottom: 15px;
            font-weight: bold;
            color: #555;
            font-size: 24px;
        }

        .date-selectors {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        select {
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            font-size: 22px;
            cursor: pointer;
        }

        .note {
            margin-top: 25px;
            padding: 15px;
            background-color: #fff9db;
            border-left: 6px solid #f1c40f;
            font-size: 19px;
            color: #555;
            line-height: 1.6;
            border-radius: 4px;
        }

        .result-section {
            display: flex;
            justify-content: center;
        }

        .card {
            width: 100%;
            max-width: 850px;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 35px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.12);
            border-top: 15px solid var(--primary-color);
            display: none;
        }

        .card.active { display: block; }
        .card.criminal { border-top-color: var(--criminal-color); }
        .card.civil { border-top-color: var(--civil-color); }

        .card h3 {
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
            font-size: 36px;
            text-align: center;
        }

        .level-block { margin-bottom: 35px; }
        .level-title {
            font-weight: bold;
            color: #444;
            margin-bottom: 15px;
            background: #f1f3f5;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-block;
            font-size: 26px;
        }

        .deadline-item {
            display: flex;
            justify-content: space-between;
            padding: 18px 0;
            border-bottom: 1px dashed #ddd;
        }

        .deadline-label { color: #555; font-weight: 500; }
        .deadline-value { font-weight: 900; color: var(--accent-color); font-size: 28px; }

        .footer {
            text-align: center;
            margin-top: 60px;
            margin-bottom: 30px;
            font-size: 18px;
            color: #777;
        }

        /* 手機版截圖彈窗 */
        #screenshot-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            padding-top: 30px;
            text-align: center;
        }

        #screenshot-modal img {
            max-width: 90%;
            max-height: 70%;
            border: 2px solid #fff;
            border-radius: 10px;
        }

        .modal-tip {
            color: #fff;
            margin-top: 20px;
            font-size: 20px;
            line-height: 1.5;
            padding: 0 20px;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }

        /* RWD 改進 */
        @media (max-width: 900px) {
            .input-row { flex-direction: column; }
            .control-row { flex-direction: column; align-items: stretch; }
            .type-switch label { flex: 1; padding: 10px 0; }
            .download-btn { justify-content: center; }
        }

        @media (max-width: 600px) {
            body { padding: 10px; font-size: 18px; }
            .container { padding: 10px; }
            .page-title { font-size: 30px; }
            .header-section { padding: 15px; }
            .input-group { min-width: 100%; }
            .input-group label { font-size: 20px; }
            .date-selectors { justify-content: space-between; }
            .date-selectors select { flex: 1; min-width: 0; padding: 8px 5px; font-size: 18px; }
            .card { padding: 20px 15px; }
            .card h3 { font-size: 26px; }
            .level-title { font-size: 20px; }
            .deadline-item { flex-direction: column; gap: 5px; }
            .deadline-value { font-size: 24px; text-align: right; }
            .note { font-size: 16px; }
        }
    </style>
</head>
<body>

<div class="container" id="main-content">
    <div class="page-title">上訴期間計算小工具</div>

    <div class="header-section">
        <div class="control-row">
            <div class="type-switch">
                <input type="radio" id="type-crim" name="caseType" value="criminal" checked>
                <label for="type-crim" class="lab-crim">刑事</label>
                <input type="radio" id="type-civ" name="caseType" value="civil">
                <label for="type-civ" class="lab-civ">民事</label>
            </div>
            
            <button class="download-btn" id="btn-save">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                下載截圖
            </button>
        </div>

        <div class="input-row">
            <div class="input-group">
                <label>收到判決日期：</label>
                <div class="date-selectors">
                    <select id="recv-y"></select> 年
                    <select id="recv-m"></select> 月
                    <select id="recv-d"></select> 日
                </div>
            </div>

            <div class="input-group">
                <label>聲明上訴日期：</label>
                <div class="date-selectors">
                    <select id="notice-y"><option value="">--</option></select> 年
                    <select id="notice-m"><option value="">--</option></select> 月
                    <select id="notice-d"><option value="">--</option></select> 日
                </div>
            </div>
        </div>

        <div class="note">
            註：本工具僅供參考，計算並未包含「在途期間」。實際上訴期限請自行依法律規定計算為準。
        </div>
    </div>

    <!-- 結果區 -->
    <div class="result-section">
        <div id="card-criminal" class="card criminal active">
            <h3>刑事上訴期間</h3>
            <div class="level-block">
                <div class="level-title">一審上訴二審</div>
                <div class="deadline-item">
                    <span class="deadline-label">聲明上訴期限 (20日內)</span>
                    <span class="deadline-value" id="crim-1-2-notice">-</span>
                </div>
                <div class="deadline-item">
                    <span class="deadline-label">補上訴理由期限 (40日內)</span>
                    <span class="deadline-value" id="crim-1-2-reason">-</span>
                </div>
            </div>
            <div class="level-block">
                <div class="level-title">二審上訴三審</div>
                <div class="deadline-item">
                    <span class="deadline-label">聲明上訴期限 (20日內)</span>
                    <span class="deadline-value" id="crim-2-3-notice">-</span>
                </div>
                <div class="deadline-item">
                    <span class="deadline-label">補上訴理由期限 (聲明後20日)</span>
                    <span class="deadline-value" id="crim-2-3-reason">-</span>
                </div>
            </div>
        </div>

        <div id="card-civil" class="card civil">
            <h3>民事上訴期間</h3>
            <div class="level-block">
                <div class="level-title">一審上訴二審</div>
                <div class="deadline-item">
                    <span class="deadline-label">聲明上訴期限 (20日內)</span>
                    <span class="deadline-value" id="civ-1-2-notice">-</span>
                </div>
                <div class="deadline-item">
                    <span class="deadline-label">補上訴理由期限</span>
                    <span class="deadline-value" style="color:var(--civil-color)">依法院通知</span>
                </div>
            </div>
            <div class="level-block">
                <div class="level-title">二審上訴三審</div>
                <div class="deadline-item">
                    <span class="deadline-label">聲明上訴期限 (20日內)</span>
                    <span class="deadline-value" id="civ-2-3-notice">-</span>
                </div>
                <div class="deadline-item">
                    <span class="deadline-label">補上訴理由期限 (聲明後20日)</span>
                    <span class="deadline-value" id="civ-2-3-reason">-</span>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        © 2025 楊時綱. All Rights Reserved.
    </div>
</div>

<!-- 截圖預覽 Modal -->
<div id="screenshot-modal">
    <span class="close-modal" id="close-modal">&times;</span>
    <img id="screenshot-img" src="" alt="截圖預覽">
    <div class="modal-tip">
        <strong>【偵測到手機瀏覽器】</strong><br>
        請「長按圖片」選擇「儲存圖片」或「下載圖片」即可存入相簿。
    </div>
</div>

<script>
    function initDropdowns() {
        const selects = ['recv', 'notice'];
        selects.forEach(prefix => {
            const y = document.getElementById(prefix + '-y');
            const m = document.getElementById(prefix + '-m');
            const d = document.getElementById(prefix + '-d');
            for (let i = 114; i <= 164; i++) y.add(new Option(i, i));
            for (let i = 1; i <= 12; i++) m.add(new Option(i, i));
            for (let i = 1; i <= 31; i++) d.add(new Option(i, i));
        });
        document.getElementById('recv-y').value = 115;
        document.getElementById('recv-m').value = 1;
        document.getElementById('recv-d').value = 1;
    }

    function getJSDate(prefix) {
        const y = parseInt(document.getElementById(prefix + '-y').value);
        const m = parseInt(document.getElementById(prefix + '-m').value);
        const d = parseInt(document.getElementById(prefix + '-d').value);
        if (isNaN(y) || isNaN(m) || isNaN(d)) return null;
        return new Date(y + 1911, m - 1, d);
    }

    function formatROC(date) {
        if (!date || isNaN(date.getTime())) return "日期錯誤";
        return `民國 ${date.getFullYear() - 1911} / ${date.getMonth() + 1} / ${date.getDate()}`;
    }

    function formatFilenameDate(date) {
        const y = date.getFullYear() - 1911;
        const m = (date.getMonth() + 1).toString().padStart(2, '0');
        const d = date.getDate().toString().padStart(2, '0');
        return `${y}${m}${d}`;
    }

    function calculate() {
        const recvDate = getJSDate('recv');
        const noticeDate = getJSDate('notice');
        if (!recvDate) return;
        const d20 = new Date(recvDate.getTime() + 20 * 24 * 60 * 60 * 1000);
        const d20Str = formatROC(d20);
        ['crim-1-2-notice', 'crim-2-3-notice', 'civ-1-2-notice', 'civ-2-3-notice'].forEach(id => {
            document.getElementById(id).innerText = d20Str;
        });
        document.getElementById('crim-1-2-reason').innerText = formatROC(new Date(recvDate.getTime() + 40 * 24 * 60 * 60 * 1000));
        if (noticeDate) {
            const reasonD20 = formatROC(new Date(noticeDate.getTime() + 20 * 24 * 60 * 60 * 1000));
            document.getElementById('crim-2-3-reason').innerText = reasonD20;
            document.getElementById('civ-2-3-reason').innerText = reasonD20;
        } else {
            document.getElementById('crim-2-3-reason').innerText = "(待填寫聲明日期)";
            document.getElementById('civ-2-3-reason').innerText = "(待填寫聲明日期)";
        }
    }

    function toggleCard() {
        const isCrim = document.getElementById('type-crim').checked;
        document.getElementById('card-criminal').classList.toggle('active', isCrim);
        document.getElementById('card-civil').classList.toggle('active', !isCrim);
    }

    // 儲存/截圖核心功能
    function processSave() {
        const recvDate = getJSDate('recv');
        const noticeDate = getJSDate('notice');
        if (!recvDate) return;

        let targetDate = noticeDate ? new Date(noticeDate.getTime() + 20 * 24 * 60 * 60 * 1000) : new Date(recvDate.getTime() + 20 * 24 * 60 * 60 * 1000);
        const dateStr = formatFilenameDate(targetDate);
        const container = document.getElementById('main-content');
        
        // 判斷是否為手機端 (偵測寬度或 UserAgent)
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 900;

        html2canvas(container, {
            backgroundColor: '#FAF7F2',
            scale: 2 
        }).then(canvas => {
            const dataURL = canvas.toDataURL('image/jpeg', 0.9);
            
            if (isMobile) {
                // 手機版：顯示彈窗並提示長按
                document.getElementById('screenshot-img').src = dataURL;
                document.getElementById('screenshot-modal').style.display = 'block';
            } else {
                // 電腦版：直接下載
                const link = document.createElement('a');
                link.download = `${dateStr}上訴期間_.jpg`;
                link.href = dataURL;
                link.click();
            }
        });
    }

    // 關閉 Modal
    document.getElementById('close-modal').onclick = function() {
        document.getElementById('screenshot-modal').style.display = 'none';
    }

    document.getElementById('btn-save').addEventListener('click', processSave);
    document.querySelectorAll('select, input[name="caseType"]').forEach(el => {
        el.addEventListener('change', () => { calculate(); toggleCard(); });
    });

    initDropdowns();
    calculate();
</script>

</body>
</html>